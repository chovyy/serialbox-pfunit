MODULE m_serialbox_test
   
  USE ISO_FORTRAN_ENV
  USE pfunit_mod
  USE m_serialize
  
  IMPLICIT NONE
  
  PUBLIC 

  TYPE(t_serializer) :: serializer

CONTAINS

@Before
   SUBROUTINE mySetup()

      CALL fs_create_serializer("sb2", 'test', 'w', serializer)
      
      OPEN(unit=10, file='testData.txt', form='formatted', access='sequential', status='new')
      WRITE(10,'(a)')'record 1'
      WRITE(10,'(a)')'record 2'
      REWIND(10)
   END SUBROUTINE mySetup
   
@After
   SUBROUTINE myTearDown()
      CLOSE(10, status='delete')
      
      CALL fs_destroy_serializer(serializer)
      
   END SUBROUTINE myTearDown

@Test
   SUBROUTINE testRead()
      INTEGER :: value
      CHARACTER(len=20) :: string
      
      READ(10,'(a6,1x,i5)') string, value
      @assertEqual(1, value)
      
      READ(10,'(a6,1x,i5)') string, value
      @assertEqual(2, value)
      
   END SUBROUTINE testRead

@Test
   SUBROUTINE testEOF()
      integer :: value
      character(len=20) :: string
      integer :: eof
      
      READ(10,'(a6,1x,i5)') string, value
      READ(10,'(a6,1x,i5)') string, value
      READ(10,'(a6,1x,i5)', iostat=eof) string, value
      
      @assertEqual(IOSTAT_END, eof)

   END SUBROUTINE testEOF

END MODULE m_serialbox_test


